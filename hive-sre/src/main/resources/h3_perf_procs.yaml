processes:
  -
    type: "dbSet"
    name: "Hive 3 Performance Checks - Locations Scan"
    errorFilename: h3_perf_scan.err
    successFilename: h3_perf_scan.txt
    queryDefinitionReference: "/hive_upgrade_queries.yaml"
    dbListingQuery: "db_tbl_count"
    listingColumns: ["db_name" ,"tbl_name" , "tbl_type" ,"part_name" , "path_check"]
    pathsListingQuery: "tbl_part_locations"
    checks:
      - name: "Small Files"
        invertCheck: false
        pathCommand: "count %5$s"
        onSuccessPathCommand: "File sizes: %1$s.%2$s [Partition: %4$s]"
        onSuccessRecordCommand: "# Folders: %1$s Files: %2$s Size: %3$s Path: %4$s"
        reportOnResults: true
        reportOnPath: true
        processOnError: false
        processOnSuccess: true
        checkCalculations:
          avgFileSize: "\"Average File Size in Path: \" + java.math.BigDecimal.valueOf((%3$s / %2$s)).divide(new java.math.BigDecimal(1024*1024), 3) + \"Mb\""
          avgFileSizeTooSmall: "if (%3$s / %2$s < 67108864) \"CHECKPOINT FAILED: Average file size below 64Mb\""
